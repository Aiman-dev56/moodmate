<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoodyMate - Mental Wellness Companion </title>
  <link rel="stylesheet" href="../style/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

</head>

<body>


  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4 mb-0">
    <!-- Logo and Brand -->
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="../img/logo-removebg-preview.png" alt="Logo" height="40" class="me-2">
      <span class="fw-bold fs-4">MoodMate</span>
    </a>

    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Center and Right Items -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <!-- Centered nav links -->
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
          <a class="nav-link text-white" href="../index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="#">Services</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
            More
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Therapy</a></li>
            <li><a class="dropdown-item" href="../html/moodjournal.html">Journal</a></li>
          </ul>
        </li>
      </ul>

      <!-- Right aligned user button -->
<ul class="navbar-nav ms-auto">

  <!-- üîπ Login Button (hidden when logged in) -->
  <li class="nav-item" id="loginNavItem">
    <a href="./html/register.html#loginSectionId" 
       class="btn btn-outline-primary px-3 py-1"
       style="border-radius: 30px; font-weight: 600;">
      Login
    </a>
  </li>

  <!-- üîπ User Dropdown (hidden when logged out) -->
  <li class="nav-item dropdown" id="userDropdown" style="display: none;">
    <a class="btn btn-outline-primary dropdown-toggle px-3 py-1 d-flex align-items-center gap-2"
       href="#" id="navbarUser" role="button" data-bs-toggle="dropdown" aria-expanded="false"
       style="border-radius: 30px; font-weight: 600;">
       
      <!-- User Icon -->
      <span id="userIcon"
        class="bg-white text-dark rounded-circle d-inline-flex justify-content-center align-items-center"
        style="width: 28px; height: 28px; font-size: 14px; font-weight: bold;">
        <i class="bi bi-person-circle"></i>
      </span>

      <!-- Username -->
      <span id="navbarUsername">User</span>
    </a>

    <ul class="dropdown-menu dropdown-menu-end mt-2" aria-labelledby="navbarUser">
      <li><a class="dropdown-item" href="#" onclick="logoutUser()" id="logoutBtn">Logout</a></li>
    </ul>
  </li>
</ul>
    </div>
  </nav>
  <!-- ‚úÖ Removed extra </nav> -->

  <!-- Sidebar (if used for mobile) -->
  <div id="sidebar">
    <button class="close-btn" onclick="closeSidebar()">√ó</button>
    <a href="../index.html">Home</a>
    <a href="#">Services</a>
    <a href="#">Therapy</a>
    <a href="../html/moodjournal.html">Journal</a>
    <a href="../html/register.html#loginSectionId">Login</a>
  </div>

  <!-- Hero Section -->
  <section class="hero-section" style="margin-top: 0;">
    <div class="hero-overlay"></div>
    <div class="container hero-content">
      <div class="row align-items-center">
        <!-- Left Text -->
        <div class="col-md-6">
          <h1 class="display-4 fw-bold" data-aos="zoom-in" data-aos-duration="2000">Welcome to BootMate</h1>
          <p class="lead fs-4 fw-semibold">Your personal mental wellness companion.</p>
          <a href="#mentalHealth" class="btn btn-outline-light mt-3" data-bs-toggle="modal" data-bs-target="#chatModal">Start Chat üí¨</a>
        </div>

        <!-- Right Image -->
        <div class="col-md-6 text-center">
          <img src="../img/doctor-removebg-preview.png" alt="Hero" class="img-fluid hero-img">
        </div>
      </div>
    </div>
  </section>



  <!-- My Chats Section -->
<section id="myChats" class="container" style="margin: 100px;">
  <h3 class="text-center">üí¨ My Conversations</h3>
  <div id="chatList" class="d-flex flex-wrap gap-2 justify-content-center">
    <!-- Chat buttons will be loaded here -->
  </div>
</section>



  



<!-- chat section -->

<!-- Chat Modal -->
<div class="modal fade" id="chatModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content chat-content text-white">
      <div class="modal-header border-0">
        <h5 class="m-0">MoodMate-AI</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">

        <!-- Buttons Section -->
        <div id="chatList" class="d-flex flex-wrap gap-2 justify-content-center"></div>

        <!-- Chat Box (‚úÖ Added) -->
        <div id="chatBox" class="p-2 mt-3 border rounded bg-dark" 
             style="height: 250px; overflow-y: auto;">
          <p class="text-muted">üí¨ Select a chat to begin</p>
        </div>

        <!-- Input + Send -->
        <div class="modal-footer border-0 p-2">
          <div class="input-group">
            <input id="userMessage" type="text" class="form-control" placeholder="Type your message‚Ä¶">
            <!-- ‚úÖ Fixed onclick -->
            <button id="sendBtn" class="btn btn-success">
              ‚û§
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>






  <script type="module">
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
import { 
  getFirestore, collection, addDoc, getDocs, doc, updateDoc, arrayUnion, serverTimestamp 
} from "firebase/firestore";
import { 
  getAuth, onAuthStateChanged 
} from "firebase/auth";

// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyDxtk7rTwEBPT1W73scgPAMOsLrFXRaXVU",
  authDomain: "mood-mate-7d071.firebaseapp.com",
  projectId: "mood-mate-7d071",
  storageBucket: "mood-mate-7d071.appspot.com",
  messagingSenderId: "1043535041128",
  appId: "1:1043535041128:web:19f578531ba6dce4fa21dd",
  measurementId: "G-WSW5BQZGYR"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const auth = getAuth(app);

// --- Variables ---
let currentUser = null;
let currentConversationId = null;

const chatBox = document.getElementById("chatBox");
const chatList = document.getElementById("chatList");

// ‚úÖ Check login state
onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
    renderChatButtons();
  } else {
    currentUser = null;
    chatList.innerHTML = "<p>Please log in to view chats</p>";
  }
});

// ‚úÖ Render buttons
async function renderChatButtons() {
  if (!currentUser) return;
  chatList.innerHTML = "";

  // New Chat Button
  const newBtn = document.createElement("button");
  newBtn.className = "btn btn-success";
  newBtn.innerText = "‚ûï Start New Chat";
  newBtn.onclick = startNewChat;
  chatList.appendChild(newBtn);

  // Previous Chats
  const convsSnap = await getDocs(collection(db, "chats", currentUser.uid, "conversations"));
  let count = 1;
  convsSnap.forEach(docSnap => {
    const data = docSnap.data();
    const btn = document.createElement("button");
    btn.className = "btn btn-outline-primary";
    btn.innerText = `Chat ${count++}`;
    btn.onclick = () => loadChat(docSnap.id, data);
    chatList.appendChild(btn);
  });

  if (convsSnap.empty) {
    const msg = document.createElement("p");
    msg.innerText = "No chats yet. Start a new one!";
    chatList.appendChild(msg);
  }
}

// ‚úÖ Start New Chat
async function startNewChat() {
  if (!currentUser) return alert("‚ö†Ô∏è Please log in first!");
  chatList.style.display = "none";
  const convRef = await addDoc(collection(db, "chats", currentUser.uid, "conversations"), {
    createdAt: serverTimestamp(),
    messages: []
  });
  currentConversationId = convRef.id;
  chatBox.innerHTML = `<div class="bot-message">üí¨ New conversation started!</div>`;
}

// ‚úÖ Load Old Chat
function loadChat(convId, data) {
  currentConversationId = convId;
  chatList.style.display = "none";
  chatBox.innerHTML = "";
  data.messages.forEach(msg => {
    chatBox.innerHTML += `<div class="${msg.sender}-message"><b>${msg.sender}:</b> ${msg.text}</div>`;
  });
  chatBox.scrollTop = chatBox.scrollHeight;
}

// ‚úÖ Send Message
async function sendMessage() {
  const input = document.getElementById("userMessage");
  const text = input.value.trim();
  if (!text || !currentConversationId) return;

  chatBox.innerHTML += `<div class="user-message"><b>You:</b> ${text}</div>`;
  input.value = "";

  const convRef = doc(db, "chats", currentUser.uid, "conversations", currentConversationId);
  await updateDoc(convRef, {
    messages: arrayUnion({ sender: "user", text, time: new Date().toISOString() })
  });

  const res = await fetch("http://127.0.0.1:8000/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: text })
  });
  const data = await res.json();

  chatBox.innerHTML += `<div class="bot-message"><b>Bot:</b> ${data.answer}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;

  await updateDoc(convRef, {
    messages: arrayUnion({ sender: "bot", text: data.answer, time: new Date().toISOString() })
  });
}

// ‚úÖ Reset when modal closes
document.getElementById("chatModal").addEventListener("hidden.bs.modal", () => {
  chatList.style.display = "flex";
  renderChatButtons();
});
</script>






<script src="../js/app.js"></script>

<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <!-- AOS JS -->
  <script>
    AOS.init({
      once: false,
      duration: 1200
    });
  </script>




  <script type="module" src="../js/auth.js"></script>
 



</body>